FROM ubuntu/squid:latest

# Copy your custom configuration
COPY squid.conf /etc/squid/squid.conf
COPY passwd /etc/squid/passwd

# Set proper permissions
RUN chown proxy:proxy /etc/squid/passwd && \
    chmod 640 /etc/squid/passwd && \
    mkdir -p /var/spool/squid && \
    chown -R proxy:proxy /var/spool/squid

# Initialize cache (this might already be done in base image)
RUN squid -z

EXPOSE 3128

CMD ["squid", "-NYC"]

# Health check
#HEALTHCHECK --interval=60s --timeout=10s --start-period=90s --retries=2 \
#    CMD squid -k check || exit 1

# The base image should already have the correct CMD
# But if needed: CMD ["squid", "-N", "-d", "1"]