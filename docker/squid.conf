# squid.conf - Optimized for t3.micro using ubuntu/squid image

# HTTP port
http_port 3128

# Authentication setup
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd
auth_param basic children 3
auth_param basic realm Squid Proxy for n8n
auth_param basic credentialsttl 4 hours

# Access Control Lists
acl authenticated proxy_auth REQUIRED
#whitelist ip that do not required authentication
#acl static_ip src 183.178.xxx.xxx/32

# SSL and safe ports
acl SSL_ports port 443
acl Safe_ports port 80 443 8080 1025-65535
acl CONNECT method CONNECT

# Access rules
http_access allow static_ip
http_access allow authenticated
http_access allow CONNECT SSL_ports
http_access allow Safe_ports
http_access deny all

# Optimized cache settings for t3.micro
cache_dir ufs /var/spool/squid 200 8 16
maximum_object_size 10 MB
cache_mem 64 MB
maximum_object_size_in_memory 512 KB

# Memory optimization
memory_pools off
memory_pools_limit 32 MB

# Performance tuning
client_lifetime 30 minutes
half_closed_clients off
pconn_timeout 60 seconds
request_timeout 60 seconds
connect_timeout 30 seconds

# Reduce resource usage
fqdncache_size 512
ipcache_size 512

# Logging
access_log /var/log/squid/access.log
cache_log /var/log/squid/cache.log

# DNS
dns_nameservers 8.8.8.8 8.8.4.4

# Specific optimizations for official ubuntu/squid image
visible_hostname squid-proxy
unique_hostname squid-proxy-ecs